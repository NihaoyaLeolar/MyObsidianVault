---
tags:
  - 缓存
---
>在同时使用数据库和缓存时，为了解决数据的一致性问题，主动更新缓存的一种机制 ———— **由缓存的调用者，在更新数据库的同时更新缓存**。

# 一些思考
---
操作缓存和数据库时有三个问题需要考虑：

### 1. 删除缓存还是更新缓存？
- 删除缓存：更新数据库时让缓存失效，查询时再更新缓存 ✅
- 更新缓存：每次更新数据库都更新缓存，无效写操作较多 ❌

### 2. 如何保证缓存与数据库的操作的同时成功或失败？ 
采用事务来完成
- 单体系统，将缓存与数据库操作放在一个事务
- 分布式系统，利用TCC等分布式事务方案

### 3. 先操作缓存还是先操作数据库？
#### 先操作数据库，再删除缓存 ✅
左图是理想情况，不太容易发生右图线程安全问题！因为缓存操作(4)大概率比2数据库操作(2)快，如果再给缓存加上超时剔除功能的话，就更好了！
![[CleanShot 2024-02-27 at 18.13.46@2x.png|307]]![[CleanShot 2024-02-27 at 18.14.25@2x.png|300]]

#### 先删除缓存，再操作数据库  ❌
左图是理想情况，但十分容易发生右图线程安全问题！
![[CleanShot 2024-02-27 at 18.08.13@2x.png|300]]![[CleanShot 2024-02-27 at 18.09.04@2x.png|308]]

# 结论
---
思考了以上问题，就可以得出[[缓存更新策略的最佳实践方案]]了

