---
tags:
---
- [x] 看懂chroma接口服务项目
问题：向量化这个过程具体是怎么实现的，没有看得很懂

## 1. 尝试将课程数据向量化
- [x] 学会使用 pymongo
- [x] 调用写好的接口，将字段向量化存入

🌶️ **问题**：读取了mongoDB中的所有document后，可以一次拿到CourseName字段。但是在调用`insert函数`时会报错，原因是传入的`d`没有`text字段`...但是，有啊...可能是我对python的语法不熟悉吧？

![|300](https://cdn.nlark.com/yuque/0/2023/png/25369650/1686749544475-a811b512-f1d9-4100-b81f-54dabf6ae033.png) ![|300](https://cdn.nlark.com/yuque/0/2023/png/25369650/1688026126369-9d5c9317-0d56-4e2c-b151-a101f91e80d0.png)

**已解决**：传入Document类对象，而不是字典类型。但是注意创建对象时需要传入text字段，因为要求时必须传入的，不然会报错。果然是对python不够熟悉...

通过改写上面的代码，写好了一个demo，可以从数据库中取出东西并存入chroma向量化：
- 将需要存入向量数据库的字符串放在`text字段`
```python
import pymongo
from pymongo import MongoClient
from datastore import DataStore
from models import Document

store = DataStore()

# 连接mongoDB
mongo_client = MongoClient('localhost', 27017)
db = mongo_client['MOOC123']
collection = db['CoursesBackup-2023-06-08']

# 获取数据库中内容
dataList = collection.find()

# 存入chroma
for data in dataList:
    doc = Document(
        text = data['CourseName']
    )
    print(doc.text)
    store.insert("CourseTest", doc)

```
chroma中课程collection:
```
{
    "name": "CourseTest",
    "id": "fe9a07bb-d8dc-465c-852b-7efc1828b08c",
    "metadata": null
}
```

## 2. 继续进行向量化
- 以课程名字为text
- 以课程介绍为text
注意：如果把一样的text存入chroma，会重复存入

🌶️ **问题：61001第一个接口，传入类型的问题**
如果传入的是id，查询的结果是空，会认为没找该collection，并且会自动创建一个名字为这串id的collection...传入name才正常...

![400|400](https://cdn.nlark.com/yuque/0/2023/png/25369650/1688028911865-106c53ec-2a5e-4bc7-9f91-ba1a9dae10ba.png)

**已解决**：老师的demo代码中调用api时对应错了，官方文档中是传入name。我将api的接口字段名更改。

![475|475](https://cdn.nlark.com/yuque/0/2023/png/25369650/1688029229769-6fb0c5c2-34b8-433a-99f0-cbf04e9e0b37.png)

## 3. 思考用什么text将课程数据向量化更好
目前老师是说用：ContentInfo.describe
>注意：ContentInfo里也可能不止一个，而且decribe字段里带有大量html格式语句，有些内容比较少，格式语句甚至更多。

以下字段也会包含课程信息：
```text
CourseName:
SubjectInfo：[]
ContentInfo[0]: Describe. Outline
```

![](https://cdn.nlark.com/yuque/0/2023/png/25369650/1688029949485-868c1625-7c1d-4548-98fb-f40a9a8c74f7.png)