# 邮件攻击的概念
-----
>电子邮件威胁：攻击者利用电子邮件作为攻击手段来传播恶意软件、诈骗、钓鱼等非法活动的行为。这种攻击方式利用了电子邮件广泛传播和用户相信邮件来源的特点，以欺骗、感染或骗取用户为目的。
## 根据攻击手段划分类别
- **木马钓鱼**：攻击者在邮件中植入恶意附件，诱使接受者打开邮件，从而感染计算机系统并获取敏感信息或控制受害者的计算机。
- **链接钓鱼**：诱使用户进入伪装好的相似链接，引导用户输入有用信息，从而获取帐密等
## 攻击目的
- **窃密**：获取敏感信息、商业机密、个人隐私等机密信息
- **控制**：长期稳定地掌控对目标的获取权
- **破坏**：破坏国家基础设施等

提到的一些工具：Trezor套件

# 邮件基础知识
-----
## 电子邮件的通信协议
#### 1. SMTP（Simple Mail Transfer Protocol）
   - SMTP 是最常用的邮件传输协议，用于发送和传输电子邮件。
   - SMTP 协议使用明文传输，邮件内容和传输过程中的数据都是未加密的，因此存在安全风险。
   - SMTP 默认使用 25 号端口。
#### 2. SMTPS（Simple Mail Transfer Protocol Secure）
   - SMTPS 是 SMTP 协议的扩展版本，通过在传输层使用 TLS（Transport Layer Security）或 SSL（Secure Sockets Layer）协议来加密邮件的传输。
   - SMTPS 使用加密技术保护邮件内容和传输过程中的数据安全，提供了更高的安全性和私密性。
   - SMTPS 默认使用 465 号端口。

上面两个协议的主要区别在于安全性方面：**SMTP 是明文传输的，而 SMTPS 是加密传输的**。由于安全性的考虑，SMTPS 通常更受欢迎，特别是在传输敏感信息的电子邮件时。然而，SMTPS 目前逐渐被更安全的协议 STARTTLS（SMTP with STARTTLS）所取代，因为 STARTTLS 提供了更好的兼容性和安全性。
#### 3. IMAP
交互邮件访问协议，端口号143，用于邮件客户端和邮件服务器之间的交互。
#### 4. POP3（Post Office Protocol version 3）
用于接收电子邮件的网络协议。它是电子邮件客户端和邮件服务器之间的标准通信协议，用于从邮件服务器上下载用户的电子邮件。

## 电子邮件安全的三大技术
### 1. SPF(Sender Policy Framework)
**防止电子邮件的地址被伪造**，他可以验证发出电子邮件的服务器是否被电子邮件的所有者授权！
- 原理：检测发件人ip和Mail From中的域名是否匹配!!!!
通过在DNS服务器记录中发布一个SPF记录实现，SPF记录列出了被授权的发送邮件的服务器(ip)。

#### 邮件SPF设置隐患
当邮件服务器的SPF设置不严格或伪造的域名TXT记录存在问题，可通过直连目标邮件服务器通过SMTP协议里直接伪造发件人。
**1. SPF记录设置为：`v=spf1 ip4：220.xxx.10.0/24~all**`
只允许220.xxx.10.1~220.x0xx.10.255范围内的IP，软拒绝，发件IP非法，但是不采取强硬措施。
- IP段过大，在C段里面，只要获取任意一台主机的权限，那么就可以使用合法的IP进行邮件伪造。
- 软拒绝，也就是会接受来信，但可能被标记为垃圾邮件。如果SPF记录设置拒绝，就会有大量的邮件被丢弃或者隔离，影响办公效率，有一些邮件系统管理员为了减少业务影响，而采用软拒绝的策略。
**2. SPF配置不当**
- 域名增加了SPF记录，但是邮件服务器不支持SPF检查或邮件网关未开启SPF检测，无法验证邮件来源。
- SPF解析在公网DNS，邮件服务器配置内部DNS，内部DNS无法进行SPF解析，从而导致绕过

### 2. DKIM(DomainKeys Identified Mail)
用于**验证邮件的真实性和完整性**的电子邮件验证技术。它通过在发件服务器上对邮件进行数字签名，并在邮件的DNS记录中添加公钥，来实现对邮件来源的认证。
DKIM使用一种非对称加密算法，发件服务器使用私钥对邮件的头部和内容进行加密，生成一段加密签名，并将该签名添加到邮件的头部。同时，发件服务器将相应的公钥添加到邮件的DNS记录中。
### 3. DMARC (Domain-based Message Authentication, Reporting, and Conformance)
结合了以上两者
## 电子邮件结构
邮件包含邮件头和邮件体，保存成文件的后缀为`.eml`（有点像html）
包含很多字段！可以具体再用再查！
# 实战
----
攻击工具：[swaks](https://www.jetmore.org/john/code/swaks/)
攻击命令：
```shell
# 发件人伪装成 admin@ofse.com, 攻击老师的邮箱：laptergrsd@139.com
swaks --body "test" --header "Subject:HelloWorld" -t laptergrsd@139.com -f "admin@ofse.com"
```

课后自己进行[[swaks邮件攻击探索]]

信息收集获取手段：
- 谷歌搜索技巧
- 邮件营销服务提供商：snov
- 专业的暴露面搜索引擎：hunter.io


其他工具
- RLO钓鱼
- Pumycode
- 搭建钓鱼网站：Zphish，直接在github上有资源
- evilginx