---
tags:
  - JVM
---
可以通过在编程中，[[使用jol查看Java对象头]]，来加深对下面东西的理解。
# 对象头模型
---
## 普通对象
- Klass Word：类型指针
```java
|-----------------------------------------------------| 
|                Object Header (64 bits)              | 
|---------------------------|-------------------------| 
|      Mark Word (32 bits)  |  Klass Word (32 bits)   | 
|---------------------------|-------------------------|
```
## 数组对象
---
```java
|---------------------------------------------------------------------------------| 
|                                 Object Header (96 bits)                         | 
|--------------------------------|-----------------------|------------------------| 
|       Mark Word(32bits)        |   Klass Word(32bits)  |  array length(32bits)  | 
|--------------------------------|-----------------------|------------------------|
```

# Mark Word 模型
---
Mark Word 的最后两位表示状态：
- 01：
	- 且倒数第三位 biased_lock == 0 ：无锁状态，存储一些基本信息
	- 且倒数第三位 biased_lock == 1 ：偏向锁状态，存储少量基本信息和偏向的线程id
- 00：轻量级锁状态，存储锁记录`lock record`的地址
- 10：重量级锁状态，存储管程`monitor`的指针
## 32bit
```java
|-------------------------------------------------------|--------------------| 
|                   Mark Word (32 bits)                 |        State       | 
|-------------------------------------------------------|--------------------| 
| hashcode:25         | age:4 | biased_lock:0    |  01  |        Normal      | 
|-------------------------------------------------------|--------------------| 
| thread:23 | epoch:2 | age:4 | biased_lock:1    |  01  |        Biased      | 
|-------------------------------------------------------|--------------------| 
| ptr_to_lock_record:30                          |  00  | Lightweight Locked | 
|-------------------------------------------------------|--------------------| 
| ptr_to_heavyweight_monitor:30                  |  10  | Heavyweight Locked | 
|-------------------------------------------------------|--------------------| 
|                                                |  11  |    Marked for GC   | 
|-------------------------------------------------------|--------------------|
```
## 64bit
```java
|-----------------------------------------------------------------|--------------------| 
|                 Mark Word (64 bits)                             |        State       | 
|-----------------------------------------------------------------|--------------------| 
| unused:25 | hashcode:31 | unused:1 | age:4 | biased_lock:0 | 01 |        Normal      | 
|-----------------------------------------------------------------|--------------------| 
| thread:54 |   epoch:2   | unused:1 | age:4 | biased_lock:1 | 01 |        Biased      | 
|-----------------------------------------------------------------|--------------------| 
| ptr_to_lock_record:62                                      | 00 | Lightweight Locked | 
|-----------------------------------------------------------------|--------------------| 
| ptr_to_heavyweight_monitor:62                              | 10 | Heavyweight Locked | 
|-----------------------------------------------------------------|--------------------| 
|                                                            | 11 |    Marked for GC   | 
|-----------------------------------------------------------------|--------------------|
```
